--[[
ULTRA SPY + DUMPER + AUTO COPY TO CLIPBOARD
‚Ä¢ Spy URLs + Dump de jogo
‚Ä¢ Dump de URL/Hub: baixa, desofusca b√°sico, copia pro clipboard
‚Ä¢ Anti-reset GUI
]]

if getgenv().ExecutorFixLoaded then return end
getgenv().ExecutorFixLoaded = true

-- Servi√ßos
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")

getgenv().CapturedURLs = getgenv().CapturedURLs or {}
getgenv().LiveSpy = getgenv().LiveSpy or {}

-- Anti-reset GUI
local ProtectedGuis = {}

local function protectGui(gui)
	gui.ResetOnSpawn = false
	table.insert(ProtectedGuis, gui)
end

local function reattachGuis()
	local pg = Player:WaitForChild("PlayerGui")
	for _, gui in ipairs(ProtectedGuis) do
		if gui and gui.Parent \~= pg then
			gui.Parent = pg
		end
	end
end

Player.CharacterAdded:Connect(function()
	task.wait(0.5)
	reattachGuis()
end)

-- Drag system (igual antes)
local function makeDraggable(frame, handle)
	handle = handle or frame
	frame.Active = true
	handle.Active = true

	local dragging = false
	local dragStart, startPos

	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
		end
	end)

	handle.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)

	handle.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- Logger
local function logLive(url, src)
	table.insert(getgenv().LiveSpy, os.date("%X").." ["..src.."] "..url)
	table.insert(getgenv().CapturedURLs, url)
end

-- Hooks spy (igual antes, resumido)
local oldHttpGet = hookfunction(game.HttpGet, function(self, url, ...)
	if typeof(url) == "string" then logLive(url, "HttpGet") end
	return oldHttpGet(self, url, ...)
end)

-- ... (adicione os outros hooks se quiser: HttpGetAsync, request, etc.)

-- Decoders + desofusca b√°sico
local function tryBase64(str)
	local ok, res = pcall(function() return HttpService:Base64Decode(str) end)
	if ok and res then return res end
end

local function decodeHex(str)
	return (str:gsub("\\x(%x%x)", function(h) return string.char(tonumber(h,16)) end))
end

local function decodeChar(str)
	local s = ""
	for num in str:gmatch("%d+") do
		s = s .. string.char(tonumber(num))
	end
	return s
end

local function deobBasic(code)
	code = code:gsub("string%.char%(%s*(.-)%s*%)", function(chars) return '"' .. decodeChar(chars) .. '"' end)
	code = code:gsub('""%s*%-%-%s*""', "")  -- remove concat vazio
	-- Mais patterns se quiser
	return code
end

-- Risk classifier (igual)
local function classify(url)
	url = url:lower()
	if url:find("discord") or url:find("webhook") then return "üî¥ PERIGOSO" end
	if url:find("paste") or url:find("anon") then return "üü° SUSPEITO" end
	if url:find("github") or url:find("raw") then return "üü¢ SAFE" end
	return "üü° SUSPEITO"
end

-- Deep scan
local function deepScan(text)
	local found = {}
	local function add(v)
		if v and #v > 5 then found[v] = classify(v) end
	end

	for url in text:gmatch("https?://[%w%p]+") do add(url) end
	for str in text:gmatch([["(.-)"]]) do
		add(tryBase64(str))
		add(decodeHex(str))
		add(decodeChar(str))
	end
	-- ... (resto igual ao original)

	local result = {}
	for k, risk in pairs(found) do
		table.insert(result, "["..risk.."] "..k)
	end
	return result, text  -- retorna links + c√≥digo original
end

-- Fun√ß√£o pra mostrar notifica√ß√£o (se exploit suportar)
local function notify(title, text)
	StarterGui:SetCore("SendNotification", {Title = title, Text = text, Duration = 5})
end

-- =========================
-- GUI PRINCIPAL
-- =========================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltraSpyDumper"
ScreenGui.Parent = Player:WaitForChild("PlayerGui")
protectGui(ScreenGui)

local Main = Instance.new("Frame", ScreenGui)
Main.Position = UDim2.fromScale(0.1, 0.1)
Main.Size = UDim2.fromScale(0.8, 0.6)
Main.BackgroundColor3 = Color3.fromRGB(25,25,25)
Main.BorderSizePixel = 0
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,12)

-- Top bar + drag + min/close (igual antes, resumido)
-- ... (copie a parte de addWindowControls se quiser)

local TextBox = Instance.new("TextBox", Main)
TextBox.Position = UDim2.new(0,10,0,50)
TextBox.Size = UDim2.new(1,-20,0.7,-100)
TextBox.MultiLine = true
TextBox.ClearTextOnFocus = false
TextBox.TextWrapped = true
TextBox.TextYAlignment = Enum.TextYAlignment.Top
TextBox.Font = Enum.Font.Code
TextBox.TextSize = 14
TextBox.TextColor3 = Color3.new(1,1,1)
TextBox.BackgroundColor3 = Color3.fromRGB(35,35,35)
TextBox.Text = "-- Cole a URL do hub/script aqui (ex: pastebin.com/raw/abc)"

-- Bot√£o DUMP & COPY
local DumpButton = Instance.new("TextButton", Main)
DumpButton.Size = UDim2.new(0.48,0,0,40)
DumpButton.Position = UDim2.new(0.01,10,0.92,-50)
DumpButton.Text = "DUMP & COPY URL"
DumpButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
DumpButton.TextColor3 = Color3.new(1,1,1)
DumpButton.Font = Enum.Font.GothamBold

Instance.new("UICorner", DumpButton)

-- Bot√£o executar spy normal (opcional, mantive)
local ExecButton = Instance.new("TextButton", Main)
ExecButton.Size = UDim2.new(0.48,0,0,40)
ExecButton.Position = UDim2.new(0.51,0,0.92,-50)
ExecButton.Text = "EXECUTAR + SPY"
ExecButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
ExecButton.TextColor3 = Color3.new(1,1,1)
ExecButton.Font = Enum.Font.GothamBold

Instance.new("UICorner", ExecButton)

-- Fun√ß√£o principal pro dump de URL + copy
DumpButton.MouseButton1Click:Connect(function()
	local url = TextBox.Text:match("https?://.+")  -- pega s√≥ a URL v√°lida
	if not url or #url < 10 then
		notify("Erro", "Cole uma URL v√°lida!")
		return
	end
	
	notify("Iniciando", "Baixando e dumpando da URL...")
	
	local success, code = pcall(function()
		return game:HttpGet(url)
	end)
	
	if not success or not code then
		notify("Erro", "Falha ao baixar: " .. tostring(code))
		return
	end
	
	-- Deep scan + desofusca
	local links, original = deepScan(code)
	local dumped = deobBasic(code)  -- ou use original se preferir sem desofusca
	
	-- Mostra na TextBox (ou crie uma nova janela se quiser)
	TextBox.Text = "-- DUMP FINAL (copiado pro clipboard!)\n\n" .. dumped .. "\n\nLinks encontrados:\n" .. table.concat(links, "\n")
	
	-- Copia pro clipboard
	if setclipboard then
		setclipboard(dumped)
		notify("Sucesso!", "C√≥digo dumpado copiado pra √°rea de transfer√™ncia! Cole onde quiser.")
	else
		notify("Aviso", "setclipboard n√£o suportado no seu exploit. C√≥digo est√° na caixa acima.")
	end
end)

-- ExecButton (spy normal, pode manter ou remover)
-- ... (adicione o que tinha antes se quiser)

print("Ultra Spy + Dumper + Auto Copy carregado!")
